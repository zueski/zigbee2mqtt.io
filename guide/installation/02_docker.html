<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <script>if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { window.document.querySelector('html').classList.add('dark');} </script><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" color="#ffc135" href="/safari-pinned-tab.svg"><meta name="msapplication-TileColor" content="#ffc135"><meta name="theme-color" content="#ffc135"><title>Docker | Zigbee2MQTT</title><meta name="description" content="Zigbee to MQTT bridge, get rid of your proprietary Zigbee bridges">
    <link rel="stylesheet" href="/assets/css/styles.990b4fd5.css">
    <link rel="preload" href="/assets/js/runtime~app.d47d1e6c.js" as="script"><link rel="preload" href="/assets/css/styles.990b4fd5.css" as="style"><link rel="preload" href="/assets/js/9854.a1e31846.js" as="script"><link rel="preload" href="/assets/js/app.100b506e.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon content-page" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/logo.png" alt="Zigbee2MQTT"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Zigbee2MQTT</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Guide"><span class="title">Guide</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Guide"><span class="title">Guide</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/getting-started/" aria-label="Getting started"><!---->Getting started<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/adapters/" aria-label="Supported Adapters"><!---->Supported Adapters<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/supported-devices/" aria-label="Supported Devices"><!---->Supported Devices<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/guide/installation/" aria-label="Installation"><!---->Installation<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/configuration/" aria-label="Configuration"><!---->Configuration<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/usage/pairing_devices.html" aria-label="Usage"><!---->Usage<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/faq/" aria-label="FAQ"><!---->FAQ<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/supported-devices/" aria-label="Devices"><!---->Devices<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Advanced"><span class="title">Advanced</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Advanced"><span class="title">Advanced</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zigbee</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/01_zigbee_network.html" aria-label="Zigbee network"><!---->Zigbee network<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/02_improve_network_range_and_stability.html" aria-label="Improve network range and stability"><!---->Improve network range and stability<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/03_secure_network.html" aria-label="Secure your Zigbee network"><!---->Secure your Zigbee network<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/04_sniff_zigbee_traffic.html" aria-label="Sniff Zigbee traffic"><!---->Sniff Zigbee traffic<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/05_create_a_cc2530_router.html" aria-label="Create a CC2530 router"><!---->Create a CC2530 router<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Support new devices</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/01_support_new_devices.html" aria-label="Support new devices"><!---->Support new devices<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/02_support_new_tuya_devices.html" aria-label="Support new Tuya devices"><!---->Support new Tuya devices<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/03_find_tuya_data_points.html" aria-label="Find Tuya Data Points"><!---->Find Tuya Data Points<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Remote Adapter</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/remote-adapter/connect_to_a_remote_adapter.html" aria-label="Connect to a remote adapter"><!---->Connect to a remote adapter<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/remote-adapter/connect_to_a_remote_sonoff_zbbridge.html" aria-label="Connect to a remote Sonoff ZBBridge"><!---->Connect to a remote Sonoff ZBBridge<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>More</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/3d_cases.html" aria-label="3D cases"><!---->3D cases<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/switch-to-dev-branch.html" aria-label="Switch to the dev branch"><!---->Switch to the dev branch<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/tuya_xiaomi_ota_url.html" aria-label="Get Tuya and Xiaomi OTA url"><!---->Get Tuya and Xiaomi OTA url<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/user_extensions.html" aria-label="User extensions"><!---->User extensions<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Support"><span class="title">Support</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Support"><span class="title">Support</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt/discussions" aria-label="Forum" rel="noopener noreferrer" target="_blank"><!---->Forum<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://discord.gg/NyseBeK" aria-label="Discord" rel="noopener noreferrer" target="_blank"><!---->Discord<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt/issues" aria-label="Issues" rel="noopener noreferrer" target="_blank"><!---->Issues<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt" aria-label="Donate" rel="noopener noreferrer" target="_blank"><!---->Donate<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt.io" aria-label="GitHub (docs)" rel="noopener noreferrer" target="_blank"><!---->GitHub (docs)<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Guide"><span class="title">Guide</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Guide"><span class="title">Guide</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/getting-started/" aria-label="Getting started"><!---->Getting started<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/adapters/" aria-label="Supported Adapters"><!---->Supported Adapters<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/supported-devices/" aria-label="Supported Devices"><!---->Supported Devices<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/guide/installation/" aria-label="Installation"><!---->Installation<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/configuration/" aria-label="Configuration"><!---->Configuration<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/usage/pairing_devices.html" aria-label="Usage"><!---->Usage<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guide/faq/" aria-label="FAQ"><!---->FAQ<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/supported-devices/" aria-label="Devices"><!---->Devices<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Advanced"><span class="title">Advanced</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Advanced"><span class="title">Advanced</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zigbee</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/01_zigbee_network.html" aria-label="Zigbee network"><!---->Zigbee network<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/02_improve_network_range_and_stability.html" aria-label="Improve network range and stability"><!---->Improve network range and stability<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/03_secure_network.html" aria-label="Secure your Zigbee network"><!---->Secure your Zigbee network<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/04_sniff_zigbee_traffic.html" aria-label="Sniff Zigbee traffic"><!---->Sniff Zigbee traffic<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/zigbee/05_create_a_cc2530_router.html" aria-label="Create a CC2530 router"><!---->Create a CC2530 router<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Support new devices</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/01_support_new_devices.html" aria-label="Support new devices"><!---->Support new devices<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/02_support_new_tuya_devices.html" aria-label="Support new Tuya devices"><!---->Support new Tuya devices<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/support-new-devices/03_find_tuya_data_points.html" aria-label="Find Tuya Data Points"><!---->Find Tuya Data Points<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Remote Adapter</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/remote-adapter/connect_to_a_remote_adapter.html" aria-label="Connect to a remote adapter"><!---->Connect to a remote adapter<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/remote-adapter/connect_to_a_remote_sonoff_zbbridge.html" aria-label="Connect to a remote Sonoff ZBBridge"><!---->Connect to a remote Sonoff ZBBridge<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>More</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/3d_cases.html" aria-label="3D cases"><!---->3D cases<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/switch-to-dev-branch.html" aria-label="Switch to the dev branch"><!---->Switch to the dev branch<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/tuya_xiaomi_ota_url.html" aria-label="Get Tuya and Xiaomi OTA url"><!---->Get Tuya and Xiaomi OTA url<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/advanced/more/user_extensions.html" aria-label="User extensions"><!---->User extensions<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Support"><span class="title">Support</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Support"><span class="title">Support</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt/discussions" aria-label="Forum" rel="noopener noreferrer" target="_blank"><!---->Forum<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://discord.gg/NyseBeK" aria-label="Discord" rel="noopener noreferrer" target="_blank"><!---->Discord<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt/issues" aria-label="Issues" rel="noopener noreferrer" target="_blank"><!---->Issues<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt" aria-label="Donate" rel="noopener noreferrer" target="_blank"><!---->Donate<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Koenkk/zigbee2mqtt.io" aria-label="GitHub (docs)" rel="noopener noreferrer" target="_blank"><!---->GitHub (docs)<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/getting-started/" aria-label="Getting started"><!---->Getting started<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/supported-hardware.html" aria-label="Supported Hardware"><!---->Supported Hardware<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/guide/adapters/" aria-label="Adapters"><!---->Adapters<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/supported-devices/" aria-label="Devices"><!---->Devices<!----></a><!----></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/guide/installation/" aria-label="Installation"><!---->Installation<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/01_linux.html" aria-label="Linux"><!---->Linux<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/guide/installation/02_docker.html" aria-label="Docker"><!---->Docker<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/03_ha_addon.html" aria-label="Home Assistant addon"><!---->Home Assistant addon<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/04_openhabian.html" aria-label="openHABian"><!---->openHABian<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/05_windows.html" aria-label="Windows"><!---->Windows<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/06_freebsd_jail.html" aria-label="FreeBSD jail"><!---->FreeBSD jail<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/07_python_virtual_environment.html" aria-label="Python Virtual Environment"><!---->Python Virtual Environment<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/15_watchdog.html" aria-label="Watchdog"><!---->Watchdog<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/installation/20_zigbee2mqtt-fails-to-start.html" aria-label="Zigbee2MQTT fails to start"><!---->Zigbee2MQTT fails to start<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/configuration/" aria-label="Configuration"><!---->Configuration<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/adapter-settings.html" aria-label="Adapter settings"><!---->Adapter settings<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/mqtt.html" aria-label="MQTT"><!---->MQTT<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/zigbee-network.html" aria-label="Zigbee network"><!---->Zigbee network<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/frontend.html" aria-label="Frontend"><!---->Frontend<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/devices-groups.html" aria-label="Devices and Groups"><!---->Devices and Groups<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/logging.html" aria-label="Logging"><!---->Logging<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/block-pass-list.html" aria-label="Device blocklist / passlist"><!---->Device blocklist / passlist<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/ota-device-updates.html" aria-label="OTA device firmware update"><!---->OTA device firmware update<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/device-availability.html" aria-label="Device-Availability"><!---->Device-Availability<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/homeassistant.html" aria-label="Home Assistant integration"><!---->Home Assistant integration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/configuration/more-config-options.html" aria-label="More configuration options"><!---->More configuration options<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/usage/" aria-label="Usage"><!---->Usage<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/pairing_devices.html" aria-label="Allowing devices to join"><!---->Allowing devices to join<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/integrations.html" aria-label="Integrations"><!---->Integrations<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/touchlink.html" aria-label="Touchlink"><!---->Touchlink<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/scenes.html" aria-label="Scenes"><!---->Scenes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/binding.html" aria-label="Binding"><!---->Binding<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/groups.html" aria-label="Groups"><!---->Groups<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/ota_updates.html" aria-label="OTA updates"><!---->OTA updates<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/mqtt_topics_and_messages.html" aria-label="MQTT Topics and Messages"><!---->MQTT Topics and Messages<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/usage/exposes.html" aria-label="Exposes"><!---->Exposes<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/guide/faq/" aria-label="FAQ"><!---->FAQ<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h1><p>It is possible to run Zigbee2MQTT in a Docker container using the official <a href="https://hub.docker.com/r/koenkk/zigbee2mqtt/" target="_blank" rel="noopener noreferrer">Zigbee2MQTT Docker image</a>.</p><p>This image support the following architectures: <code>386</code>, <code>amd64</code>, <code>arm/v6</code>, <code>arm/v7</code>, <code>arm64</code>. Since Zigbee2MQTT images are manifest listed, Docker will auto-detect the architecture and pull the right image.</p><p>Start by figuring out the location of your adapter as explained <a class="route-link" href="/guide/installation/01_linux.html#determine-location-of-the-adapter-and-checking-user-permissions">here</a>.</p><p><strong>IMPORTANT</strong>: Using a Raspberry Pi? Make sure to check <a href="#notes-for-raspberry-pi-users">Notes for Raspberry Pi users</a>.</p><h2 id="creating-the-initial-configuration" tabindex="-1"><a class="header-anchor" href="#creating-the-initial-configuration"><span>Creating the initial configuration</span></a></h2><p>Navigate to the directory where you will store the Zigbee2MQTT data and execute the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">wget</span> https://raw.githubusercontent.com/Koenkk/zigbee2mqtt/master/data/configuration.yaml <span class="token parameter variable">-P</span> data</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now configure the MQTT server and adapter location as explained <a class="route-link" href="/guide/installation/01_linux.html#configuring">here</a>.</p><h2 id="running-the-container" tabindex="-1"><a class="header-anchor" href="#running-the-container"><span>Running the container</span></a></h2><p>Execute the following command, update the <code>--device</code> parameter to match the location of your adapter.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">docker</span> run <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">--name</span> zigbee2mqtt <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">--device</span><span class="token operator">=</span>/dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00:/dev/ttyACM0 <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">-v</span> <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/data:/app/data <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">-v</span> /run/udev:/run/udev:ro <span class="token punctuation">\</span></span>
<span class="line">   <span class="token parameter variable">-e</span> <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Europe/Amsterdam <span class="token punctuation">\</span></span>
<span class="line">   koenkk/zigbee2mqtt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Parameters explanation:</strong></p><ul><li><code>--name zigbee2mqtt</code>: Name of container</li><li><code>--restart=unless-stopped</code>: Automatically start on boot and restart after a crash</li><li><code>--device=/dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00:/dev/ttyACM0</code>: Location of adapter (e.g. CC2531). The path before the <code>:</code> is the path on the host, the path after it is the path that is mapped to inside the container. You should always use the <code>/dev/serial/by-id/</code> path on the host.</li><li><code>-v $(pwd)/data:/app/data</code>: Directory where Zigbee2MQTT stores it configuration (pwd maps to the current working directory)</li><li><code>-v /run/udev:/run/udev:ro</code>: only required for auto-detecting the port and some adapters like ConBee</li><li><code>-e TZ=Europe/Amsterdam</code>: Configure the timezone</li><li><code>-p 8080:8080</code>: port forwarding from inside Docker container to host (for the frontend)</li></ul><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>If you run the MQTT-Server on the same host (localhost) you could use the IP of the <code>docker0</code> bridge to establish the connection: <code>server: mqtt://172.17.0.1</code>.</p></div><h3 id="rootless-container" tabindex="-1"><a class="header-anchor" href="#rootless-container"><span>Rootless container</span></a></h3><p>To improve the security of the deployment you may want to run Zigbee2MQTT as a <em>non-root</em> user.</p><ol><li>Identify the group that has access to the adapter (in Ubuntu, e.g. it might be assigned to <code>dialout</code>). Update <code>ttyACM0</code> to match your adapter location.</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ ls -l /dev/ttyACM0</span>
<span class="line">crw-rw---- 1 root dialout 166, 0 Nov 5 16:31 /dev/ttyACM0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>If you want to run Zigbee2MQTT using your current user find the <code>uid</code> (UserID) and <code>gid</code> (GroupID):</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ id</span>
<span class="line">uid=1001(pi) gid=1001(pi) Groups=...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Start the docker container after updating <code>device</code>, <code>user</code> (uid:gid) and <code>group-add</code>:</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ sudo docker run \</span>
<span class="line">   --name=zigbee2mqtt \</span>
<span class="line">   --restart=unless-stopped \</span>
<span class="line">   -p 8080:8080 \</span>
<span class="line">   -v $(pwd)/data:/app/data \</span>
<span class="line">   -v /run/udev:/run/udev:ro \</span>
<span class="line">   --device=/dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00:/dev/ttyACM0 \</span>
<span class="line">   --user 1001:1001 \</span>
<span class="line">   --group-add dialout \</span>
<span class="line">   -e TZ=Europe/Amsterdam \</span>
<span class="line">   koenkk/zigbee2mqtt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.1</p><p><strong>Parameters explanation:</strong></p><ul><li><code>--user 1001:1001</code>: Run the Zigbee2MQTT process within the container using the provided UserID and GroupID</li><li><code>--group-add dialout</code>: Assign the <code>dialout</code> group to the user to be able to access the device</li></ul><h3 id="rootless-with-podman-3-2" tabindex="-1"><a class="header-anchor" href="#rootless-with-podman-3-2"><span>Rootless with Podman (&gt;3.2)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ podman run \</span>
<span class="line">   --name=zigbee2mqtt \</span>
<span class="line">   --restart=unless-stopped \</span>
<span class="line">   -p 8080:8080 \</span>
<span class="line">   -v $(pwd)/data:/app/data \</span>
<span class="line">   -v /run/udev:/run/udev:ro \</span>
<span class="line">   --device=/dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF-if00:/dev/ttyACM0 \</span>
<span class="line">   --group-add keep-groups \</span>
<span class="line">   -e TZ=Europe/Amsterdam \</span>
<span class="line">   koenkk/zigbee2mqtt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="updating" tabindex="-1"><a class="header-anchor" href="#updating"><span>Updating</span></a></h2><p>To update to the latest Docker image:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> pull koenkk/zigbee2mqtt:latest</span>
<span class="line"><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> zigbee2mqtt</span>
<span class="line"><span class="token comment"># Now run the container again with the instructions above</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="tags" tabindex="-1"><a class="header-anchor" href="#tags"><span>Tags</span></a></h2><p>The following tags are available:</p><ul><li>Latest release version: <code>latest</code></li><li>Latest dev version (based on <a href="https://github.com/Koenkk/zigbee2mqtt/tree/dev" target="_blank" rel="noopener noreferrer"><code>dev</code></a> branch): <code>latest-dev</code></li><li>Specific release version, e.g: <code>1.7.0</code></li></ul><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose"><span>Docker Compose</span></a></h2><p>Example of a Docker Compose file:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">zigbee2mqtt</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zigbee2mqtt</span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> koenkk/zigbee2mqtt</span>
<span class="line">        <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">        <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/app/data</span>
<span class="line">            <span class="token punctuation">-</span> /run/udev<span class="token punctuation">:</span>/run/udev<span class="token punctuation">:</span>ro</span>
<span class="line">        <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># Frontend port</span></span>
<span class="line">            <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line">        <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> TZ=Europe/Berlin</span>
<span class="line">        <span class="token key atrule">devices</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># Make sure this matched your adapter location</span></span>
<span class="line">            <span class="token punctuation">-</span> /dev/serial/by<span class="token punctuation">-</span>id/usb<span class="token punctuation">-</span>Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0018ED3DDF<span class="token punctuation">-</span>if00<span class="token punctuation">:</span>/dev/ttyACM0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also run a rootless container with Docker Compose by adding the required attributes to the <code>zigbee2mqtt</code> service block in your <code>docker-compose.yml</code>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">group_add</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> dialout</span>
<span class="line"><span class="token key atrule">user</span><span class="token punctuation">:</span> 1000<span class="token punctuation">:</span><span class="token number">1000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="starting-the-container" tabindex="-1"><a class="header-anchor" href="#starting-the-container"><span>Starting the container</span></a></h3><p>To start the Docker container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span> zigbee2mqtt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You can optionally skip <code>zigbee2mqtt</code> and it will start all containers listed in the compose file.</p><h3 id="updating-1" tabindex="-1"><a class="header-anchor" href="#updating-1"><span>Updating</span></a></h3><p>To update to the latest Docker image:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> compose pull zigbee2mqtt</span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span> zigbee2mqtt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>You can optionally skip <code>zigbee2mqtt</code> and it will pull any new images for all containers in the compose file, and then restart those that were updated.</p><h2 id="notes-for-raspberry-pi-users" tabindex="-1"><a class="header-anchor" href="#notes-for-raspberry-pi-users"><span>Notes for Raspberry Pi users</span></a></h2><ul><li>If you are running Raspbian Buster (not Bullseye nor Bookworm!) (find out by executing <code>grep &quot;PRETTY_NAME&quot; /etc/os-release</code>) you need to install <code>libseccomp2</code>, this can be done by executing the following commands:</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> apt-key adv <span class="token parameter variable">--keyserver</span> hkps://keyserver.ubuntu.com:443 --recv-keys 04EE7237B7D453EC 648ACFD622F3D138</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;deb http://httpredir.debian.org/debian buster-backports main contrib non-free&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;/etc/apt/sources.list.d/debian-backports.list&quot;</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libseccomp2 <span class="token parameter variable">-t</span> buster-backports</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you do not do this you will get the following error when starting the Zigbee2MQTT container:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment"># Fatal error in , line 0</span></span>
<span class="line"><span class="token comment"># unreachable code</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#</span></span>
<span class="line"><span class="token comment">#FailureMessage Object: 0x7eace25c</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>For Raspberry Pi 1 and zero users: there is a bug in Docker which selects the wrong image architecture. Before executing <code>docker run</code> pull the correct image with <code>docker pull koenkk/zigbee2mqtt --platform linux/arm/v6</code>.</li></ul><h2 id="docker-stack-device-mapping" tabindex="-1"><a class="header-anchor" href="#docker-stack-device-mapping"><span>Docker Stack device mapping</span></a></h2><p><em>This is only relevant when using Docker Stack</em></p><p>Docker stack doesn&#39;t support device mappings with option <code>--devices</code> when deploying a stack in swarm mode. There are two solutions to this. Both of these solutions start with binding the devices as volumes.</p><h3 id="automatic-device-mapping-for-cgroup-v1-and-v2" tabindex="-1"><a class="header-anchor" href="#automatic-device-mapping-for-cgroup-v1-and-v2"><span>Automatic device mapping for cgroup v1 and v2</span></a></h3><p>The easiest solution for enabling devices on Docker Stacks is the <a href="https://github.com/allfro/device-mapping-manager" target="_blank" rel="noopener noreferrer">allfro device-mapping-manager docker image</a>. This container has a tiny program that reads all of the volume mounts on its own host, identifies devices, and then modifies the permissions on the host to allow the container to use them. Unlike other solutions, this works for both versions of cgroups.</p><p>This container has to be deployed directly to docker, not through a stack. It&#39;s possible to work around this by creating a stack with a privileged service that acts as a proxy to launch the actual device mapper container.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">dmm</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker</span>
<span class="line">        <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> docker</span>
<span class="line">        <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</span>
<span class="line">        <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="line">            run</span>
<span class="line">            -i</span>
<span class="line">            --rm</span>
<span class="line">            --privileged</span>
<span class="line">            --cgroupns=host</span>
<span class="line">            --pid=host</span>
<span class="line">            --userns=host</span>
<span class="line">            -v /sys:/host/sys</span>
<span class="line">            -v /var/run/docker.sock:/var/run/docker.sock</span>
<span class="line">            -v /dev:/dev</span>
<span class="line">            ghcr.io/allfro/allfro/device-mapping-manager:latest</span></span>
<span class="line">        <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock</span>
<span class="line">        <span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">mode</span><span class="token punctuation">:</span> global</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="manual-cgroup-v1" tabindex="-1"><a class="header-anchor" href="#manual-cgroup-v1"><span>Manual cgroup v1</span></a></h3><p>A workaround is to manually set the right permissions. The workaround is based on the solution found at <a href="https://github.com/docker/swarmkit/issues/1244#issuecomment-285935430" target="_blank" rel="noopener noreferrer">Add support for devices with &quot;service create&quot;</a>, all credits goes this him.</p><p>This workaround only works with cgroup v1, which is not enabled on many newer distro releases.</p><ol><li><p>Identify serial adapter Identify the serial adapter using the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> lsusb <span class="token parameter variable">-v</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Bus 001 Device 005: ID 0451:16a8 Texas Instruments, Inc.</span>
<span class="line">Device Descriptor:</span>
<span class="line">  bLength                18</span>
<span class="line">  bDescriptorType         1</span>
<span class="line">  bcdUSB               2.00</span>
<span class="line">  bDeviceClass            2 Communications</span>
<span class="line">  bDeviceSubClass         0</span>
<span class="line">  bDeviceProtocol         0</span>
<span class="line">  bMaxPacketSize0        32</span>
<span class="line">  idVendor           0x0451 Texas Instruments, Inc.</span>
<span class="line">  idProduct          0x16a8</span>
<span class="line">  bcdDevice            0.09</span>
<span class="line">  iManufacturer           1 Texas Instruments</span>
<span class="line">  iProduct                2 TI CC2531 USB CDC</span>
<span class="line">  iSerial                 3 __0X00124B001936AC60</span>
<span class="line">  bNumConfigurations      1</span>
<span class="line">  Configuration Descriptor:</span>
<span class="line">	bLength                 9</span>
<span class="line">	bDescriptorType         2</span>
<span class="line">	wTotalLength           67</span>
<span class="line">	bNumInterfaces          2</span>
<span class="line">	bConfigurationValue     1</span>
<span class="line">	iConfiguration          0</span>
<span class="line">	bmAttributes         0x80</span>
<span class="line">	  (Bus Powered)</span>
<span class="line">	MaxPower               50mA</span>
<span class="line">	Interface Descriptor:</span>
<span class="line">	  bLength                 9</span>
<span class="line">	  bDescriptorType         4</span>
<span class="line">	  bInterfaceNumber        0</span>
<span class="line">	  bAlternateSetting       0</span>
<span class="line">	  bNumEndpoints           1</span>
<span class="line">	  bInterfaceClass         2 Communications</span>
<span class="line">	  bInterfaceSubClass      2 Abstract (modem)</span>
<span class="line">	  bInterfaceProtocol      1 AT-commands (v.25ter)</span>
<span class="line">	  iInterface              0</span>
<span class="line">	  CDC Header:</span>
<span class="line">		bcdCDC               1.10</span>
<span class="line">	  CDC ACM:</span>
<span class="line">		bmCapabilities       0x02</span>
<span class="line">		  line coding and serial state</span>
<span class="line">	  CDC Union:</span>
<span class="line">		bMasterInterface        0</span>
<span class="line">		bSlaveInterface         1</span>
<span class="line">	  CDC Call Management:</span>
<span class="line">		bmCapabilities       0x00</span>
<span class="line">		bDataInterface          1</span>
<span class="line">	  Endpoint Descriptor:</span>
<span class="line">		bLength                 7</span>
<span class="line">		bDescriptorType         5</span>
<span class="line">		bEndpointAddress     0x82  EP 2 IN</span>
<span class="line">		bmAttributes            3</span>
<span class="line">		  Transfer Type            Interrupt</span>
<span class="line">		  Synch Type               None</span>
<span class="line">		  Usage Type               Data</span>
<span class="line">		wMaxPacketSize     0x0040  1x 64 bytes</span>
<span class="line">		bInterval              64</span>
<span class="line">	Interface Descriptor:</span>
<span class="line">	  bLength                 9</span>
<span class="line">	  bDescriptorType         4</span>
<span class="line">	  bInterfaceNumber        1</span>
<span class="line">	  bAlternateSetting       0</span>
<span class="line">	  bNumEndpoints           2</span>
<span class="line">	  bInterfaceClass        10 CDC Data</span>
<span class="line">	  bInterfaceSubClass      0 Unused</span>
<span class="line">	  bInterfaceProtocol      0</span>
<span class="line">	  iInterface              0</span>
<span class="line">	  Endpoint Descriptor:</span>
<span class="line">		bLength                 7</span>
<span class="line">		bDescriptorType         5</span>
<span class="line">		bEndpointAddress     0x84  EP 4 IN</span>
<span class="line">		bmAttributes            2</span>
<span class="line">		  Transfer Type            Bulk</span>
<span class="line">		  Synch Type               None</span>
<span class="line">		  Usage Type               Data</span>
<span class="line">		wMaxPacketSize     0x0040  1x 64 bytes</span>
<span class="line">		bInterval               0</span>
<span class="line">	  Endpoint Descriptor:</span>
<span class="line">		bLength                 7</span>
<span class="line">		bDescriptorType         5</span>
<span class="line">		bEndpointAddress     0x04  EP 4 OUT</span>
<span class="line">		bmAttributes            2</span>
<span class="line">		  Transfer Type            Bulk</span>
<span class="line">		  Synch Type               None</span>
<span class="line">		  Usage Type               Data</span>
<span class="line">		wMaxPacketSize     0x0040  1x 64 bytes</span>
<span class="line">		bInterval               0</span>
<span class="line">Device Status:     0x0000</span>
<span class="line">  (Bus Powered)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>UDEV Rules</p><p>Create a new udev rule for serial adapter, <code>idVendor</code> and <code>idProduct</code> must be equal to values from <code>lsusb</code> command. The rule below creates device <code>/dev/zigbee-serial</code>:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;SUBSYSTEM==<span class="token entity" title="\&quot;">\&quot;</span>tty<span class="token entity" title="\&quot;">\&quot;</span>, ATTRS{idVendor}==<span class="token entity" title="\&quot;">\&quot;</span>0451<span class="token entity" title="\&quot;">\&quot;</span>, ATTRS{idProduct}==<span class="token entity" title="\&quot;">\&quot;</span>16a8<span class="token entity" title="\&quot;">\&quot;</span>, SYMLINK+=<span class="token entity" title="\&quot;">\&quot;</span>zigbee-serial<span class="token entity" title="\&quot;">\&quot;</span>,  RUN+=<span class="token entity" title="\&quot;">\&quot;</span>/usr/local/bin/docker-setup-zigbee-serial.sh<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/udev/rules.d/99-zigbee-serial.rules</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Reload newly created rule using the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> udevadm control --reload-rules</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Create docker-setup-zigbee-serial.sh</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /usr/local/bin/docker-setup-zigbee-serial.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Copy the following content:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token assign-left variable">USBDEV</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>readlink <span class="token parameter variable">-f</span> /dev/zigbee-serial<span class="token variable">`</span></span></span>
<span class="line"><span class="token builtin class-name">read</span> minor major <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">stat</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;%T %t&#39;</span> <span class="token variable">$USBDEV</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$minor</span> <span class="token operator">||</span> <span class="token parameter variable">-z</span> <span class="token variable">$major</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">	<span class="token builtin class-name">echo</span> <span class="token string">&#39;Device not found&#39;</span></span>
<span class="line">	<span class="token builtin class-name">exit</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"><span class="token assign-left variable">dminor</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">0</span>x${minor}<span class="token variable">))</span></span></span>
<span class="line"><span class="token assign-left variable">dmajor</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">0</span>x${major}<span class="token variable">))</span></span></span>
<span class="line"><span class="token assign-left variable">CID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> --no-trunc <span class="token operator">|</span> <span class="token function">grep</span> koenkk/zigbee2mqtt <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span> <span class="token operator">|</span>  <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">`</span></span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$CID</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">	<span class="token builtin class-name">echo</span> <span class="token string">&#39;CID not found&#39;</span></span>
<span class="line">	<span class="token builtin class-name">exit</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;Setting permissions&#39;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;c <span class="token variable">$dmajor</span>:<span class="token variable">$dminor</span> rwm&quot;</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/devices/docker/<span class="token variable">$CID</span>/devices.allow</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set permissions:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">744</span> /usr/local/bin/docker-setup-zigbee-serial.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Create docker-event-listener.sh</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /usr/local/bin/docker-event-listener.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Copy the following content:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token function">docker</span> events <span class="token parameter variable">--filter</span> <span class="token string">&#39;event=start&#39;</span><span class="token operator">|</span> <span class="token punctuation">\</span></span>
<span class="line"><span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span></span>
<span class="line">	/usr/local/bin/docker-setup-zigbee-serial.sh</span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set permissions:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">744</span> /usr/local/bin/docker-event-listener.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Create docker-event-listener.service</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/systemd/system/docker-event-listener.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Copy the following content:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>Docker Event Listener <span class="token keyword">for</span> Zigbee serial adapter</span>
<span class="line"><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target</span>
<span class="line"><span class="token assign-left variable">StartLimitIntervalSec</span><span class="token operator">=</span><span class="token number">0</span></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"><span class="token assign-left variable">Restart</span><span class="token operator">=</span>always</span>
<span class="line"><span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">1</span></span>
<span class="line"><span class="token assign-left variable">User</span><span class="token operator">=</span>root</span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/bin/bash /usr/local/bin/docker-event-listener.sh</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set permissions:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">744</span> /etc/systemd/system/docker-event-listener.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Reload daemon</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl daemon-reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Start Docker event listener</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl start docker-event-listener.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Status Docker event listener</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl status docker-event-listener.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Enable Docker event listener</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> docker-event-listener.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Verify and deploy Zigbee2MQTT stack</p><p>Now reconnect the serial adapter. Verify using the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ls</span> <span class="token parameter variable">-al</span> /dev/zigbee-serial</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">7</span> Sep <span class="token number">28</span> <span class="token number">21</span>:14 /dev/zigbee-serial -<span class="token operator">&gt;</span> ttyACM0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Below an example of a <code>docker-stack-zigbee2mqtt.yml</code>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">zigbee2mqtt</span><span class="token punctuation">:</span></span>
<span class="line">	<span class="token key atrule">image</span><span class="token punctuation">:</span> koenkk/zigbee2mqtt<span class="token punctuation">:</span>latest<span class="token punctuation">-</span>dev</span>
<span class="line">	<span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">	  <span class="token punctuation">-</span> TZ=Europe/Amsterdam</span>
<span class="line">	<span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">	  <span class="token punctuation">-</span> /mnt/docker<span class="token punctuation">-</span>cluster/zigbee2mqtt/data<span class="token punctuation">:</span>/app/data</span>
<span class="line">	  <span class="token punctuation">-</span> /dev/zigbee<span class="token punctuation">-</span>serial<span class="token punctuation">:</span>/dev/zigbee<span class="token punctuation">-</span>serial</span>
<span class="line">	<span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">	  <span class="token punctuation">-</span> proxy_traefik<span class="token punctuation">-</span>net</span>
<span class="line">	<span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">	  <span class="token key atrule">placement</span><span class="token punctuation">:</span></span>
<span class="line">		<span class="token key atrule">constraints</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>node.hostname == rpi<span class="token punctuation">-</span><span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line">	  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">proxy_traefik-net</span><span class="token punctuation">:</span></span>
<span class="line">	<span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the above example, <code>proxy_traefik-net</code> is the network to connect to the mqtt broker. The constraint makes sure Docker deploys only to this (<code>rpi-3</code>) node, where the serial adapter is connected to. The volume binding <code>/mnt/docker-cluster/zigbee2mqtt/data</code> is the zigbee2mqtt persistent directory, where <code>configuration.yaml</code> is saved.</p><p>The Zigbee2MQTT <code>configuration.yaml</code> should point to <code>/dev/zigbee-serial</code>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token punctuation">[</span><span class="token punctuation">...</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> /dev/zigbee<span class="token punctuation">-</span>serial</span>
<span class="line"><span class="token punctuation">[</span><span class="token punctuation">...</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Deploy the stack:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> stack deploy zigbee2mqtt --compose-file docker-stack-zigbee2mqtt.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h3><p>It could happen that even after the above the container is not starting correctly and bringing a &quot;Operation not permitted&quot; message in the log of the service for the device:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Error: Error while opening serialport &#39;Error: Error: Operation not permitted, cannot open /dev/zigbee-serial&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This is due to the usage of cgroupv2 instead of cgroupv1 which is not fully supported by docker/containerd. To switch from cgroupv2 to cgroupv1 you have to add <code>systemd.unified_cgroup_hierarchy=false</code> to the grub cmdline. E.g. on an Raspberry Pi 4 with Raspian Bullseye you can add it to the end of the line in the /boot/cmdline.txt file:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[...] rootfstype=ext4 fsck.repair=yes rootwait cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1 systemd.unified_cgroup_hierarchy=false</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="docker-on-synology-dsm-7-0" tabindex="-1"><a class="header-anchor" href="#docker-on-synology-dsm-7-0"><span>Docker on Synology DSM 7.0</span></a></h2><blockquote><p><strong><em>NOTE:</em></strong> This may not work with all Zigbee controllers, but has been tested with the CC2531.</p></blockquote><p>As of Disk Station Manager version 7, Synology removed the built-in support for USB-devices like a Zigbee controller. The USB support can be installed to the Linux kernel by issuing the following commands as <em>root</em>.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">modprobe usbserial</span>
<span class="line">modprobe ftdi_sio</span>
<span class="line">modprobe cdc-acm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After issuing the commands, the Zigbee controller may need to be unplugged and re-inserted to the USB port.</p><p>You may also need additional drivers based on your USB Zigbee controller setup, e.g. CH341 module is not included by default. You can download precompiled modules from jadahl.com pages - select module directory based on NAS CPU architecture (DS218+ -&gt; INTEL Celeron J3355 -&gt; Apollo Lake).</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd /lib/modules</span>
<span class="line">wget http://www.jadahl.com/iperf-arp-scan/DSM_7.0/apollolake/ch341.ko</span>
<span class="line">insmod /lib/modules/ch341.ko</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It is possible to create a start-up task that issues the above commands:</p><ol><li>Create an executable script file that contains the three modprobe commands.</li><li>Using DSM&#39;s <em>Control Panel</em> -&gt; <em>Task Scheduler</em> -&gt; <em>Create</em> -&gt; <em>Triggered Task</em> -&gt; <em>User-defined script</em> with the settings: <strong>User:</strong> root, <strong>Event:</strong> Boot-up, and a <code>bash</code> command executing the executable file under <em>Task Settings</em>.</li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/Koenkk/zigbee2mqtt.io/edit/master/docs/guide/installation/02_docker.md" aria-label="Help to make the docu better and edit this page on Github ✌" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Help to make the docu better and edit this page on Github ✌<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/guide/installation/01_linux.html" aria-label="Linux"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Linux</span></div></a><a class="route-link auto-link next" href="/guide/configuration/" aria-label="Configuration"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Configuration</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.d47d1e6c.js" defer></script><script src="/assets/js/9854.a1e31846.js" defer></script><script src="/assets/js/app.100b506e.js" defer></script>
  </body>
</html>
